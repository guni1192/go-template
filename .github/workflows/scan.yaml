name: scan

on: push

jobs:
	build:
		name: Build
		
		runs-on: ubuntu-latest

		steps:
			- name: Checkout
				uses: actions/checkout@v2
																					      
			- name: Build an image from Dockerfile
				run: docker build -t sai-lab/${{ github.repository }} .
																																				      
			- name: Run Trivy vulnerability scanner
		    uses: aquasecurity/trivy-action@master
				with:
					image-ref: 'sai-lab/${{ github.repository }}'
					format: 'table'
					exit-code: '1'
					ignore-unfixed: true
					severity: 'CRITICAL,HIGH'
